<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>TreviaGames.io - Color Arena</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap');
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body, html {
    width: 100%; height: 100%;
    background: linear-gradient(45deg, #141e30, #243b55);
    font-family: 'Poppins', sans-serif;
    overflow: hidden;
    user-select: none;
  }
  #app {
    width: 100vw; height: 100vh;
    display: flex; justify-content: center; align-items: center;
    background: #0f1624;
  }
  #gameContainer {
    position: relative;
    width: 800px;
    max-width: 95vw;
    height: 600px;
    max-height: 90vh;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 0 50px #0ff;
    background: #121a2b;
    display: flex; flex-direction: column; align-items: center;
  }
  canvas {
    border-radius: 20px;
    width: 100%;
    height: auto;
    background: #121a2b;
    display: block;
  }
  #score {
    color: #0ff;
    font-size: 28px;
    font-weight: 700;
    margin: 12px 0;
    letter-spacing: 1.3px;
    text-shadow: 0 0 10px #0ff;
  }
  /* Screens */
  .screen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(15, 22, 36, 0.95);
    color: #0ff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 25px;
    border-radius: 20px;
    z-index: 20;
  }
  .screen h1 {
    font-size: 54px;
    font-weight: 900;
    margin-bottom: 20px;
    letter-spacing: 6px;
    text-shadow: 0 0 25px #0ff;
  }
  .screen p {
    font-size: 20px;
    margin-bottom: 30px;
    color: #66ffffcc;
  }
  button {
    background: #0ff;
    border: none;
    color: #0f1624;
    font-weight: 700;
    font-size: 24px;
    padding: 16px 50px;
    border-radius: 15px;
    cursor: pointer;
    box-shadow: 0 0 25px #0ff;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #00b3b3;
    box-shadow: 0 0 40px #00b3b3;
  }
  #splashScreen {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: #0f1624;
    display: flex; justify-content: center; align-items: center;
    color: #0ff;
    font-size: 64px;
    font-weight: 900;
    letter-spacing: 8px;
    text-shadow: 0 0 35px #0ff, 0 0 70px #00ffff88;
    z-index: 100;
    user-select: none;
  }
</style>
</head>
<body>
  <div id="app">
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="score">Score: 0</div>

      <div id="splashScreen">TreviaGames</div>

      <div id="menuScreen" class="screen" style="display:none;">
        <h1>TreviaGames.io</h1>
        <p>Multiplayer Color Arena<br>Use arrow keys or WASD to move your circle.<br>Try to avoid collisions and survive!</p>
        <button id="startBtn">Start Game</button>
      </div>

      <div id="gameOverScreen" class="screen" style="display:none;">
        <h1>Game Over</h1>
        <p id="finalScoreText"></p>
        <button id="restartBtn">Play Again</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const splashScreen = document.getElementById('splashScreen');
  const menuScreen = document.getElementById('menuScreen');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const finalScoreText = document.getElementById('finalScoreText');
  const scoreElem = document.getElementById('score');
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');

  const socket = new WebSocket('https://treviagames-dusv.onrender.com'); // change to your deployed server

  const players = new Map(); // id => {x,y,color}
  let playerId = null;
  let player = null;

  let keys = {};
  let score = 0;
  let gameRunning = false;

  // Show splash for 2.5s, then show menu
  function showMenu() {
    splashScreen.style.display = 'none';
    menuScreen.style.display = 'flex';
  }
  setTimeout(showMenu, 2500);

  // Player movement speed
  const speed = 6;

  // Keyboard controls
  window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
  window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

  // Game events from server
  socket.addEventListener('open', () => {
    console.log('Connected to server');
  });

  socket.addEventListener('message', (event) => {
    const data = JSON.parse(event.data);
    if(data.type === 'init') {
      playerId = data.id;
      data.players.forEach(([id, p]) => players.set(id, p));
      player = players.get(playerId);
      updateScore(0);
    } else if(data.type === 'newPlayer') {
      players.set(data.id, { x: data.x, y: data.y, color: data.color });
    } else if(data.type === 'move') {
      if(players.has(data.id)) {
        players.get(data.id).x = data.x;
        players.get(data.id).y = data.y;
      }
    } else if(data.type === 'removePlayer') {
      players.delete(data.id);
    }
  });

  // Send player position to server
  function sendPosition() {
    if(!playerId || !player) return;
    socket.send(JSON.stringify({ type: 'move', x: player.x, y: player.y }));
  }

  // Draw a player circle with glow
  function drawPlayer(p, isSelf = false) {
    ctx.beginPath();
    ctx.fillStyle = p.color;
    ctx.shadowColor = p.color;
    ctx.shadowBlur = isSelf ? 25 : 12;
    ctx.arc(p.x, p.y, isSelf ? 22 : 16, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    if(isSelf) {
      ctx.beginPath();
      ctx.strokeStyle = '#0ff';
      ctx.lineWidth = 3;
      ctx.arc(p.x, p.y, 26, 0, Math.PI * 2);
      ctx.stroke();
    }
  }

  // Check collisions between players (circle vs circle)
  function checkCollisions() {
    const self = players.get(playerId);
    if(!self) return false;

    for(let [id, p] of players) {
      if(id === playerId) continue;
      const dx = p.x - self.x;
      const dy = p.y - self.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < 44) { // 22 + 22 radius
        return true; // collision => game over
      }
    }
    return false;
  }

  // Update score display
  function updateScore(val) {
    score = val;
    scoreElem.textContent = `Score: ${score}`;
  }

  // Game loop
  function gameLoop() {
    if(!gameRunning) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Move player based on keys
    if(player) {
      if(keys['arrowleft'] || keys['a']) player.x -= speed;
      if(keys['arrowright'] || keys['d']) player.x += speed;
      if(keys['arrowup'] || keys['w']) player.y -= speed;
      if(keys['arrowdown'] || keys['s']) player.y += speed;

      // Clamp
      player.x = Math.min(Math.max(player.x, 26), canvas.width - 26);
      player.y = Math.min(Math.max(player.y, 26), canvas.height - 26);

      sendPosition();
    }

    // Draw all players
    for(let p of players.values()) {
      drawPlayer(p, p === player);
    }

    // Increase score over time
    updateScore(score + 1);

    // Collision detection = game over
    if(checkCollisions()) {
      endGame();
      return;
    }

    requestAnimationFrame(gameLoop);
  }

  // Start game
  function startGame() {
    if(!playerId) {
      alert('Waiting for server connection...');
      return;
    }
    score = 0;
    updateScore(0);
    menuScreen.style.display = 'none';
    gameOverScreen.style.display = 'none';
    gameRunning = true;

    // Reset player position randomly
    player.x = Math.random() * (canvas.width - 52) + 26;
    player.y = Math.random() * (canvas.height - 52) + 26;
    sendPosition();

    gameLoop();
  }

  // End game
  function endGame() {
    gameRunning = false;
    finalScoreText.textContent = `Your Score: ${score}`;
    gameOverScreen.style.display = 'flex';
  }

  startBtn.addEventListener('click', startGame);
  restartBtn.addEventListener('click', startGame);

})();
</script>
</body>
</html>
